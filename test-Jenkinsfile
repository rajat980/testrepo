pipeline {
    agent any
    environment {  
        AWS_DEFAULT_REGION = "us-east-1"
        STACK_NAME = 's3-bucket'
    }
    stages {
        stage('Build') {
            steps {
              
              script{                                    
                
                withCredentials([[$class: 'AmazonWebServicesCredentialsBinding', credentialsId: "aws-cred", accessKeyVariable: 'AWS_ACCESS_KEY_ID', secretKeyVariable: 'AWS_SECRET_ACCESS_KEY']]) {
                  
                  sh '''
                    aws --version
                    aws ec2 describe-internet-gateways
                    aws ec2 describe-key-pairs
                    aws cloudformation create-stack --stack-name ${STACK_NAME} --template-body file://s3.yml --region 'us-east-1'
                    '''    
                }
            }
                                
                }                
            }
        }
    }
